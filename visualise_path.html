<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // Загрузка CSV файла и визуализация точек
        function visualizePoints(csvData) {
            var map = L.map('map');

            // Используем OpenStreetMap в качестве базовой карты
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            var points = [];

            // Чтение CSV данных
            Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function (results) {
                    // Обработка каждой строки CSV
                    results.data.forEach(function (row) {
                        var lat = parseFloat(row.lat);
                        var lon = parseFloat(row.long);

                        // Добавление точек на карту
                        var marker = L.marker([lat, lon]).addTo(map);
                        points.push(marker.getLatLng());
                    });

                    // Соединение точек линиями
                    if (points.length > 1) {
                        var polyline = L.polyline(points, {color: 'red'}).addTo(map);

                        // Автоматическое масштабирование карты к области маркеров
                        map.fitBounds(polyline.getBounds());
                    } else if (points.length === 1) {
                        // Если всего одна точка, масштабируем карту к этой точке
                        map.setView(points[0], 15);
                    }
                }
            });
        }

        // Чтение CSV файла
        fetch('public/example_10_points.csv')
            .then(response => response.text())
            .then(data => visualizePoints(data));
    </script>

</body>

</html>